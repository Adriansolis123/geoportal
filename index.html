<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GeoPortal LimÃ³n Indanza - Sistema Avanzado</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link rel="stylesheet" href="styles.css"/>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <div class="header-left">
            <h1>ğŸŒ GeoPortal LimÃ³n Indanza</h1>
            <span class="header-subtitle">Sistema Avanzado de AnÃ¡lisis Ambiental</span>
        </div>
        <div class="header-right">
            <button id="btnAnalisis" class="btn-header"><i class="fas fa-chart-bar"></i> AnÃ¡lisis</button>
            <button id="btnDenuncias" class="btn-header"><i class="fas fa-exclamation-triangle"></i> Denuncias</button>
            <button id="btnReportes" class="btn-header"><i class="fas fa-file-pdf"></i> Reportes</button>
        </div>
    </div>

    <div class="main-container">
        <!-- SIDEBAR IZQUIERDO -->
        <aside class="sidebar-left">
            <div class="sidebar-section">
                <h3>ğŸ—ºï¸ Capas Geoespaciales</h3>
                <div class="layers-container">
                    <label class="layer-item">
                        <input type="checkbox" data-layer="v_cobertura" class="layer-checkbox">
                        <span class="layer-name">ğŸŒ¿ Cobertura Vegetal</span>
                        <span class="layer-count" id="count-v_cobertura">0</span>
                    </label>
                    <label class="layer-item">
                        <input type="checkbox" data-layer="v_incendios" class="layer-checkbox">
                        <span class="layer-name">ğŸ”¥ Incendios</span>
                        <span class="layer-count" id="count-v_incendios">0</span>
                    </label>
                    <label class="layer-item">
                        <input type="checkbox" data-layer="v_poblados" class="layer-checkbox">
                        <span class="layer-name">ğŸ˜ï¸ Poblados</span>
                        <span class="layer-count" id="count-v_poblados">0</span>
                    </label>
                    <label class="layer-item">
                        <input type="checkbox" data-layer="v_educativas" class="layer-checkbox">
                        <span class="layer-name">ğŸ“š Educativas</span>
                        <span class="layer-count" id="count-v_educativas">0</span>
                    </label>
                    <label class="layer-item">
                        <input type="checkbox" data-layer="v_vias" class="layer-checkbox">
                        <span class="layer-name">ğŸ›£ï¸ Red Vial</span>
                        <span class="layer-count" id="count-v_vias">0</span>
                    </label>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>ğŸ¨ Filtros</h3>
                <div class="filters-container">
                    <label>
                        <span>Opacidad:</span>
                        <input type="range" id="opacitySlider" min="0" max="100" value="70">
                        <span id="opacityValue">70%</span>
                    </label>
                    <label>
                        <span>Radio (puntos):</span>
                        <input type="range" id="radiusSlider" min="2" max="15" value="6">
                        <span id="radiusValue">6</span>
                    </label>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>ğŸ“Š EstadÃ­sticas</h3>
                <div id="stats-container" class="stats-grid"></div>
            </div>
        </aside>

        <!-- MAPA CENTRAL -->
        <div id="map" class="map-container"></div>

        <!-- SIDEBAR DERECHO - PANEL DE CONTROL -->
        <aside class="sidebar-right">
            <div class="tabs-buttons">
                <button class="tab-btn active" data-tab="info">â„¹ï¸ Info</button>
                <button class="tab-btn" data-tab="analysis">ğŸ“ˆ AnÃ¡lisis</button>
                <button class="tab-btn" data-tab="reports">ğŸ“‹ Reportes</button>
            </div>

            <div class="tab-content active" id="tab-info">
                <h3>InformaciÃ³n de Capas</h3>
                <div id="info-panel"></div>
            </div>

            <div class="tab-content" id="tab-analysis">
                <h3>Herramientas de AnÃ¡lisis</h3>
                <div class="analysis-tools">
                    <button class="btn-analysis" id="btnBufferAnalysis">
                        <i class="fas fa-square-dashed"></i> AnÃ¡lisis de Buffer
                    </button>
                    <button class="btn-analysis" id="btnProximityAnalysis">
                        <i class="fas fa-ruler"></i> Proximidad
                    </button>
                    <button class="btn-analysis" id="btnHeatMap">
                        <i class="fas fa-fire"></i> Mapa de Calor
                    </button>
                    <button class="btn-analysis" id="btnOverlay">
                        <i class="fas fa-layer-group"></i> SuperposiciÃ³n
                    </button>
                    <button class="btn-analysis" id="btnSpatialStats">
                        <i class="fas fa-calculator"></i> EstadÃ­sticas Espaciales
                    </button>
                </div>
                <div id="analysis-results"></div>
            </div>

            <div class="tab-content" id="tab-reports">
                <h3>GeneraciÃ³n de Reportes</h3>
                <div class="report-tools">
                    <button class="btn-report" id="btnReportCobertura">
                        ğŸ“Š Cobertura Vegetal
                    </button>
                    <button class="btn-report" id="btnReportIncendios">
                        ğŸ”¥ AnÃ¡lisis Incendios
                    </button>
                    <button class="btn-report" id="btnReportPoblacion">
                        ğŸ‘¥ Riesgo Poblacional
                    </button>
                    <button class="btn-report" id="btnReportIntegral">
                        ğŸ“‹ Reporte Integral
                    </button>
                </div>
                <div id="report-results"></div>
            </div>
        </aside>
    </div>

    <!-- MODAL DENUNCIAS AVANZADO -->
    <div id="denunciasModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>ğŸ“‹ Sistema de Denuncias Ambientales</h2>
            
            <div class="tabs-modal">
                <button class="tab-modal active" data-tab-modal="nueva">Nueva Denuncia</button>
                <button class="tab-modal" data-tab-modal="listado">Listado</button>
                <button class="tab-modal" data-tab-modal="estadisticas">EstadÃ­sticas</button>
            </div>

            <!-- Nueva Denuncia -->
            <div class="tab-modal-content active" id="tab-nueva">
                <form id="formDenuncia">
                    <!-- NOMBRE - REQUERIDO -->
                    <div class="form-group">
                        <label>Nombre o SeudÃ³nimo *</label>
                        <input type="text" name="nombre" placeholder="Tu nombre (puede ser anÃ³nimo)" required>
                        <small>Puedes usar un seudÃ³nimo o nombre ficticio</small>
                    </div>

                    <!-- INFORMACIÃ“N DE CONTACTO OPCIONAL -->
                    <div class="form-section">
                        <h4>ğŸ“ Contacto (Opcional)</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email (Opcional)</label>
                                <input type="email" name="email" placeholder="tu@email.com">
                            </div>
                            <div class="form-group">
                                <label>TelÃ©fono (Opcional)</label>
                                <input type="tel" name="telefono" placeholder="+593 9 99999999">
                            </div>
                        </div>
                    </div>

                    <!-- TIPO DE PROBLEMA -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tipo de Problema *</label>
                            <select name="tipo_denuncia" required>
                                <option value="">Selecciona un tipo</option>
                                <option value="incendio">ğŸ”¥ Incendio Forestal</option>
                                <option value="deforestacion">ğŸŒ³ DeforestaciÃ³n</option>
                                <option value="contaminacion">ğŸ’¨ ContaminaciÃ³n</option>
                                <option value="fauna">ğŸ¦ Fauna en Peligro</option>
                                <option value="agua">ğŸ’§ ContaminaciÃ³n HÃ­drica</option>
                                <option value="residuos">ğŸ—‘ï¸ Residuos Ilegales</option>
                                <option value="otro">ğŸ“Œ Otro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nivel de Severidad *</label>
                            <select name="severidad" required>
                                <option value="">Selecciona severidad</option>
                                <option value="baja">ğŸŸ¢ Baja</option>
                                <option value="media">ğŸŸ¡ Media</option>
                                <option value="alta">ğŸ”´ Alta</option>
                                <option value="critica">â›” CrÃ­tica</option>
                            </select>
                        </div>
                    </div>

                    <!-- UBICACIÃ“N Y DESCRIPCIÃ“N -->
                    <div class="form-group">
                        <label>UbicaciÃ³n *</label>
                        <input type="text" name="ubicacion" placeholder="UbicaciÃ³n del problema" required>
                    </div>

                    <div class="form-group">
                        <label>DescripciÃ³n Detallada *</label>
                        <textarea name="descripcion" placeholder="Describe el problema con detalle" rows="5" required></textarea>
                    </div>

                    <!-- GEOLOCALIZACIÃ“N -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>Latitud</label>
                            <input type="number" name="latitud" step="0.000001" readonly id="lat">
                        </div>
                        <div class="form-group">
                            <label>Longitud</label>
                            <input type="number" name="longitud" step="0.000001" readonly id="lng">
                        </div>
                        <div class="form-group">
                            <button type="button" id="btnGeolocate" class="btn-geo">ğŸ“ Obtener UbicaciÃ³n</button>
                        </div>
                    </div>

                    <button type="submit" class="btn-submit">âœ“ Enviar Denuncia</button>
                </form>
            </div>

            <!-- Listado Denuncias -->
            <div class="tab-modal-content" id="tab-listado">
                <div id="denuncias-list"></div>
            </div>

            <!-- EstadÃ­sticas Denuncias -->
            <div class="tab-modal-content" id="tab-estadisticas">
                <div id="denuncias-stats"></div>
            </div>
        </div>
    </div>

    <!-- MODAL ANÃLISIS -->
    <div id="analysisModal" class="modal">
        <div class="modal-content modal-large">
            <span class="modal-close">&times;</span>
            <h2>ğŸ“ˆ Herramientas de AnÃ¡lisis Avanzado</h2>
            <div id="analysisContent"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js"></script>
</body>
</html>
